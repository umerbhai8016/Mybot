<!DOCTYPE html>
<html lang="en" class="h-full">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
<title>Universal AI</title>

<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

<style>
html, body { height:100%; }
body { overscroll-behavior:none; }
pre {
  background:#111;
  color:#fff;
  padding:12px;
  border-radius:10px;
  overflow-x:auto;
}
</style>
</head>

<body class="min-h-screen bg-gray-50 text-gray-900 dark:bg-gray-900 dark:text-gray-100 transition-colors">

<div id="loading" class="flex items-center justify-center min-h-screen text-lg font-semibold">
Loading App...
</div>

<div id="app" class="hidden min-h-screen flex">

<!-- SIDEBAR -->
<aside id="sidebar"
class="fixed md:static z-40 w-72 bg-white dark:bg-gray-800 border-r border-gray-200 dark:border-gray-700 flex flex-col transform -translate-x-full md:translate-x-0 transition-transform duration-300 h-full">

<div class="p-4 flex justify-between items-center border-b dark:border-gray-700">
<h2 class="font-semibold">Chats</h2>
<button id="closeSidebar" class="md:hidden">âœ•</button>
</div>

<button id="newChat"
class="m-4 bg-blue-600 text-white py-2 rounded-xl hover:bg-blue-700 transition">
+ New Chat
</button>

<div id="chatList" class="flex-1 overflow-y-auto px-2 space-y-1 pb-6"></div>

<div class="p-4 border-t dark:border-gray-700 space-y-2">
<button id="settingsBtn" class="w-full text-left">âš™ Settings</button>
<button id="darkToggle" class="w-full text-left">ğŸŒ™ Toggle Dark</button>
</div>

</aside>

<!-- MAIN -->
<main class="flex-1 flex flex-col relative">

<div class="flex items-center justify-between p-4 border-b dark:border-gray-700">
<button id="openSidebar" class="md:hidden">â˜°</button>
<h1 id="chatTitle" class="font-semibold">New Chat</h1>
<button id="editSystemPrompt">ğŸ§ </button>
</div>

<div id="messages"
class="flex-1 overflow-y-auto px-4 py-6 space-y-4"></div>

<div class="sticky bottom-0 p-4 bg-gray-50 dark:bg-gray-900 border-t dark:border-gray-700">
<div class="flex gap-2">
<textarea id="input"
class="flex-1 resize-none p-3 rounded-xl border dark:border-gray-600 bg-white dark:bg-gray-800"
rows="1"
placeholder="Message..."></textarea>
<button id="send"
class="bg-blue-600 text-white px-4 rounded-xl hover:bg-blue-700">
Send
</button>
</div>
</div>

</main>
</div>

<!-- SETTINGS -->
<div id="settingsModal" class="hidden fixed inset-0 bg-black/40 flex items-center justify-center z-50">
<div class="bg-white dark:bg-gray-800 p-6 rounded-2xl w-96 space-y-4">
<h2 class="font-semibold text-lg">Settings</h2>
<input id="modelName" type="text" placeholder="Model"
class="w-full p-2 rounded border dark:border-gray-600 bg-white dark:bg-gray-700">
<button id="saveSettings"
class="bg-blue-600 text-white px-4 py-2 rounded-xl w-full">
Save
</button>
</div>
</div>

<script>
(function(){

/* ===============================
   HARD-CODED API KEY (IMPORTANT)
================================= */
const API_KEY = "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";

/* =============================== */

const STORAGE_KEY = "universal_ai_data";

let state = {
model: "deepseek/deepseek-r1:free",
dark: false,
chats: [],
activeChat: null
};

function saveState(){
localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
}

function loadState(){
const data = localStorage.getItem(STORAGE_KEY);
if(data){
try { state = JSON.parse(data); }
catch{}
}
}

function applyDark(){
if(state.dark) document.documentElement.classList.add("dark");
else document.documentElement.classList.remove("dark");
}

function init(){
loadState();
applyDark();
if(!state.chats.length) createChat();
renderChatList();
openChat(state.activeChat);
document.getElementById("loading").style.display="none";
document.getElementById("app").classList.remove("hidden");
}

function createChat(){
const id=Date.now().toString();
state.chats.push({
id,
title:"New Chat",
systemPrompt:"",
messages:[]
});
state.activeChat=id;
saveState();
renderChatList();
openChat(id);
}

function renderChatList(){
const list=document.getElementById("chatList");
list.innerHTML="";
state.chats.forEach(chat=>{
const div=document.createElement("div");
div.className="p-2 rounded-lg cursor-pointer hover:bg-gray-200 dark:hover:bg-gray-700 flex justify-between";
div.innerHTML=`
<span>${chat.title}</span>
<div class="space-x-2">
<button data-rename="${chat.id}">âœ</button>
<button data-delete="${chat.id}">ğŸ—‘</button>
</div>`;
div.onclick=()=>openChat(chat.id);
list.appendChild(div);
});
}

function openChat(id){
const chat=state.chats.find(c=>c.id===id);
if(!chat) return;
state.activeChat=id;
document.getElementById("chatTitle").innerText=chat.title;
renderMessages();
saveState();
}

function renderMessages(){
const chat=getActiveChat();
const container=document.getElementById("messages");
container.innerHTML="";
if(!chat) return;
chat.messages.forEach(msg=>{
const div=document.createElement("div");
div.className=msg.role==="user"?"text-right":"text-left";
div.innerHTML=`
<div class="inline-block p-3 rounded-xl ${
msg.role==="user"
?"bg-blue-600 text-white"
:"bg-gray-200 dark:bg-gray-700"
} max-w-[80%] break-words">
${marked.parse(msg.content)}
</div>`;
container.appendChild(div);
});
container.scrollTop=container.scrollHeight;
}

function getActiveChat(){
return state.chats.find(c=>c.id===state.activeChat);
}

async function sendMessage(){
const input=document.getElementById("input");
const text=input.value.trim();
if(!text) return;

const chat=getActiveChat();
chat.messages.push({role:"user",content:text});
input.value="";
renderMessages();

chat.messages.push({role:"assistant",content:""});
renderMessages();

await streamResponse(chat);
saveState();
}

async function streamResponse(chat){

const response=await fetch("https://openrouter.ai/api/v1/chat/completions",{
method:"POST",
headers:{
"Authorization":"Bearer "+API_KEY,
"Content-Type":"application/json"
},
body:JSON.stringify({
model:state.model,
messages:[
...(chat.systemPrompt?[{role:"system",content:chat.systemPrompt}]:[]),
...chat.messages.filter(m=>m.role!=="assistant"||m.content)
],
stream:true
})
});

if(!response.body) return;

const reader=response.body.getReader();
const decoder=new TextDecoder();
let assistantMsg=chat.messages[chat.messages.length-1];

while(true){
const {value,done}=await reader.read();
if(done) break;
const chunk=decoder.decode(value,{stream:true});
const lines=chunk.split("\n");
for(let line of lines){
if(line.startsWith("data: ")){
const data=line.replace("data: ","");
if(data==="[DONE]") return;
try{
const json=JSON.parse(data);
const token=json.choices?.[0]?.delta?.content;
if(token){
assistantMsg.content+=token;
renderMessages();
}
}catch{}
}
}
}
}

document.getElementById("send").onclick=sendMessage;
document.getElementById("input").addEventListener("keydown",e=>{
if(e.key==="Enter"&&!e.shiftKey){
e.preventDefault();
sendMessage();
}
});

document.getElementById("newChat").onclick=createChat;

document.getElementById("openSidebar").onclick=()=>
document.getElementById("sidebar").classList.remove("-translate-x-full");

document.getElementById("closeSidebar").onclick=()=>
document.getElementById("sidebar").classList.add("-translate-x-full");

document.getElementById("settingsBtn").onclick=()=>
document.getElementById("settingsModal").classList.remove("hidden");

document.getElementById("saveSettings").onclick=()=>{
state.model=document.getElementById("modelName").value.trim()||state.model;
saveState();
document.getElementById("settingsModal").classList.add("hidden");
};

document.getElementById("darkToggle").onclick=()=>{
state.dark=!state.dark;
applyDark();
saveState();
};

document.getElementById("editSystemPrompt").onclick=()=>{
const chat=getActiveChat();
const prompt=window.prompt("System Prompt:",chat.systemPrompt||"");
if(prompt!==null){
chat.systemPrompt=prompt;
saveState();
}
};

document.getElementById("chatList").addEventListener("click",e=>{
const renameId=e.target.dataset.rename;
const deleteId=e.target.dataset.delete;

if(renameId){
const chat=state.chats.find(c=>c.id===renameId);
const name=window.prompt("Rename chat:",chat.title);
if(name) chat.title=name;
renderChatList();
saveState();
}

if(deleteId){
state.chats=state.chats.filter(c=>c.id!==deleteId);
if(state.activeChat===deleteId&&state.chats.length){
state.activeChat=state.chats[0].id;
}
renderChatList();
openChat(state.activeChat);
saveState();
}
});

init();

})();
</script>

</body>
</html>
