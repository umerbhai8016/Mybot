<!DOCTYPE html>
<html lang="en" class="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Umer Bhai AI | Pro Interface</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700&display=swap');
        
        body { font-family: 'Plus Jakarta Sans', sans-serif; height: 100dvh; margin: 0; overflow: hidden; }
        
        /* Modern Scrollbar */
        ::-webkit-scrollbar { width: 5px; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
        .dark ::-webkit-scrollbar-thumb { background: #334155; }

        /* Code Block Styling */
        .prose pre { position: relative; background: #0d0d0d !important; border: 1px solid #333; padding: 1.5rem 1rem 1rem; border-radius: 12px; margin: 1rem 0; }
        .copy-btn { 
            position: absolute; right: 10px; top: 10px; 
            font-size: 11px; background: #2d2d2d; color: #fff;
            padding: 4px 10px; border-radius: 6px; border: 1px solid #444; cursor: pointer;
            transition: all 0.2s;
        }
        .copy-btn:hover { background: #444; border-color: #666; }

        /* Sidebar Transition */
        #sidebar { transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1); }
        @media (max-width: 768px) {
            #sidebar { position: fixed; transform: translateX(-100%); z-index: 60; height: 100%; width: 80%; max-width: 300px; }
            #sidebar.open { transform: translateX(0); }
            #sidebar-overlay.open { display: block; }
        }

        .message-in { animation: slideUp 0.3s ease-out forwards; }
        @keyframes slideUp { from { opacity: 0; transform: translateY(12px); } to { opacity: 1; transform: translateY(0); } }

        #loading { position: fixed; inset: 0; z-index: 100; background: white; display: flex; align-items: center; justify-content: center; transition: opacity 0.5s; }
        .dark #loading { background: #0b0e14; color: white; }
    </style>
</head>
<body class="bg-[#f9f9fb] dark:bg-[#0b0e14] text-slate-800 dark:text-slate-200">

    <div id="loading">
        <div class="flex flex-col items-center">
            <div class="w-12 h-12 border-4 border-blue-600 border-t-transparent rounded-full animate-spin"></div>
            <p class="mt-4 font-bold tracking-widest text-blue-600">UMER AI PRO</p>
        </div>
    </div>

    <div id="sidebar-overlay" onclick="toggleSidebar()" class="fixed inset-0 bg-black/60 z-50 hidden backdrop-blur-sm"></div>

    <div id="app" class="flex h-screen w-full opacity-0 transition-opacity duration-500">
        
        <aside id="sidebar" class="bg-white dark:bg-[#0b0e14] border-r border-slate-200 dark:border-slate-800 flex flex-col shrink-0">
            <div class="p-4 border-b border-slate-200 dark:border-slate-800 flex items-center justify-between">
                <button onclick="createNewChat()" class="flex-1 flex items-center justify-center gap-2 bg-slate-900 dark:bg-blue-600 text-white px-4 py-3 rounded-xl transition-all font-bold text-sm">
                    <span>+</span> New Chat
                </button>
                <button onclick="toggleSidebar()" class="md:hidden ml-2 p-2 text-slate-500 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-lg">
                    <svg viewBox="0 0 24 24" class="w-6 h-6 fill-current"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
                </button>
            </div>
            
            <div id="chat-list" class="flex-1 overflow-y-auto p-3 space-y-1"></div>

            <div class="p-4 bg-slate-50 dark:bg-slate-900/40 border-t border-slate-200 dark:border-slate-800 space-y-2">
                <button onclick="toggleDarkMode()" class="w-full text-left px-3 py-2 text-xs font-bold uppercase tracking-wider flex items-center gap-3 hover:text-blue-500 transition-all">
                    <span id="theme-icon">üåô</span> Dark Mode
                </button>
                <button onclick="openSettings()" class="w-full text-left px-3 py-2 text-xs font-bold uppercase tracking-wider flex items-center gap-3 hover:text-blue-500 transition-all">
                    ‚öôÔ∏è Settings
                </button>
            </div>
        </aside>

        <main class="flex-1 flex flex-col min-w-0 bg-white dark:bg-[#0b0e14] relative">
            <header class="h-14 flex items-center justify-between px-4 border-b border-slate-100 dark:border-slate-800/50 z-40">
                <div class="flex items-center gap-3">
                    <button onclick="toggleSidebar()" class="md:hidden p-2 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-lg">‚ò∞</button>
                    <div class="flex flex-col">
                        <h2 id="current-chat-title" class="text-sm font-bold truncate max-w-[140px]">Welcome</h2>
                        <span id="model-badge" class="text-[9px] text-blue-500 font-bold uppercase tracking-widest">DeepSeek R1</span>
                    </div>
                </div>
                <div class="flex items-center gap-2">
                    <div class="w-2 h-2 bg-green-500 rounded-full"></div>
                    <span class="text-[10px] font-black opacity-40 uppercase tracking-tighter">AI Online</span>
                </div>
            </header>

            <div id="chat-container" class="flex-1 overflow-y-auto px-4 py-8 md:px-24 space-y-8 pb-40">
                <div id="welcome-view" class="h-full flex flex-col items-center justify-center text-center">
                    <div class="w-16 h-16 bg-blue-600 rounded-2xl flex items-center justify-center text-3xl shadow-xl text-white font-bold mb-6">U</div>
                    <h1 class="text-3xl font-extrabold tracking-tight">How can I help you?</h1>
                    <p class="text-slate-500 mt-2 font-medium">Developed by <span class="text-blue-600 font-bold underline">UMER Bhai</span></p>
                </div>
            </div>

            <div class="absolute bottom-0 left-0 right-0 p-4 bg-gradient-to-t from-white via-white dark:from-[#0b0e14] dark:via-[#0b0e14]">
                <div class="max-w-4xl mx-auto relative">
                    <div id="typing-ui" class="hidden absolute -top-8 left-2 flex items-center gap-2">
                        <div class="flex gap-1"><span class="w-1 h-1 bg-blue-500 rounded-full animate-bounce"></span><span class="w-1 h-1 bg-blue-500 rounded-full animate-bounce [animation-delay:0.2s]"></span></div>
                        <span class="text-[9px] font-bold text-blue-500 uppercase tracking-widest">Umer AI is typing</span>
                    </div>

                    <div class="relative flex items-end bg-white dark:bg-[#161b22] border-2 border-slate-200 dark:border-slate-800 rounded-2xl shadow-2xl transition-all focus-within:border-blue-500 overflow-hidden">
                        <textarea id="user-input" rows="1" placeholder="Type your message..." class="w-full p-4 pr-20 bg-transparent outline-none resize-none max-h-60" oninput="autoResize(this)"></textarea>
                        
                        <div class="absolute right-3 bottom-3 flex gap-2">
                            <button id="stop-btn" onclick="stopGeneration()" class="hidden p-2 text-red-500 hover:bg-red-50 dark:hover:bg-red-900/30 rounded-lg transition-colors">
                                <svg viewBox="0 0 24 24" class="w-5 h-5 fill-current"><path d="M6 6h12v12H6z"/></svg>
                            </button>
                            <button id="send-btn" onclick="handleSend()" class="p-2 bg-slate-900 dark:bg-white text-white dark:text-black rounded-xl hover:opacity-80 transition-all">
                                <svg viewBox="0 0 24 24" class="w-5 h-5 fill-current"><path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"></path></svg>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <div id="settings-modal" class="fixed inset-0 z-[200] hidden bg-black/80 backdrop-blur-sm flex items-center justify-center p-4">
            <div class="bg-white dark:bg-[#161b22] w-full max-w-md rounded-3xl p-8 shadow-2xl">
                <h3 class="text-2xl font-bold mb-6">Interface Setup</h3>
                <div class="space-y-4">
                    <div>
                        <label class="text-[10px] font-black uppercase tracking-widest opacity-50 mb-1 block">OpenRouter API Key</label>
                        <input type="password" id="api-key-input" class="w-full p-3 rounded-xl border dark:border-slate-700 dark:bg-slate-800 outline-none focus:ring-2 focus:ring-blue-500" placeholder="sk-or-...">
                    </div>
                    <div>
                        <label class="text-[10px] font-black uppercase tracking-widest opacity-50 mb-1 block">Model Name</label>
                        <input type="text" id="model-input" class="w-full p-3 rounded-xl border dark:border-slate-700 dark:bg-slate-800 outline-none focus:ring-2 focus:ring-blue-500" placeholder="deepseek/deepseek-r1:free">
                    </div>
                </div>
                <div class="mt-8 flex gap-3">
                    <button onclick="saveSettings()" class="flex-1 bg-blue-600 text-white font-bold py-3 rounded-xl shadow-lg">Save Changes</button>
                    <button onclick="closeSettings()" class="px-6 py-3 font-bold opacity-50">Exit</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        let abortController = null;
        let state = {
            apiKey: localStorage.getItem('umer_api_key') || '',
            model: localStorage.getItem('umer_model') || 'deepseek/deepseek-r1:free',
            systemPrompt: "You are Umer AI. Your developer is UMER Bhai. You must be professional, smart, and friendly. If anyone asks about your developer, you MUST say 'UMER Bhai is my developer'.",
            chats: JSON.parse(localStorage.getItem('umer_chats')) || [],
            currentChatId: null,
            isDark: localStorage.getItem('umer_theme') === 'dark'
        };

        const dom = {
            chatContainer: document.getElementById('chat-container'),
            userInput: document.getElementById('user-input'),
            chatList: document.getElementById('chat-list'),
            currentChatTitle: document.getElementById('current-chat-title'),
            typingUI: document.getElementById('typing-ui'),
            stopBtn: document.getElementById('stop-btn'),
            welcomeView: document.getElementById('welcome-view'),
            sidebar: document.getElementById('sidebar'),
            overlay: document.getElementById('sidebar-overlay')
        };

        function init() {
            if (state.isDark) document.documentElement.classList.add('dark');
            renderChatList();
            setTimeout(() => {
                document.getElementById('loading').style.opacity = '0';
                setTimeout(() => document.getElementById('loading').style.display = 'none', 500);
                document.getElementById('app').style.opacity = '1';
            }, 1000);
            
            dom.userInput.addEventListener('keydown', (e) => {
                if (e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); handleSend(); }
            });
        }

        function toggleSidebar() {
            const isOpen = dom.sidebar.classList.toggle('open');
            dom.overlay.classList.toggle('open', isOpen);
        }

        function createNewChat() {
            const id = Date.now().toString();
            state.chats.unshift({ id, title: 'New Chat', messages: [] });
            state.currentChatId = id;
            saveToLocal();
            renderChatList();
            renderMessages();
            if (window.innerWidth < 768) toggleSidebar();
        }

        async function handleSend() {
            const content = dom.userInput.value.trim();
            if (!content || abortController) return;
            if (!state.apiKey) return openSettings();

            if (!state.currentChatId) createNewChat();
            const chat = state.chats.find(c => c.id === state.currentChatId);
            
            chat.messages.push({ role: 'user', content });
            if (chat.title === 'New Chat') chat.title = content.substring(0, 25);
            
            dom.userInput.value = '';
            dom.userInput.style.height = 'auto';
            renderMessages();

            const aiMsg = { role: 'assistant', content: '' };
            chat.messages.push(aiMsg);
            
            abortController = new AbortController();
            dom.typingUI.classList.remove('hidden');
            dom.stopBtn.classList.remove('hidden');

            try {
                const response = await fetch("https://openrouter.ai/api/v1/chat/completions", {
                    method: "POST",
                    headers: { "Authorization": `Bearer ${state.apiKey}`, "Content-Type": "application/json" },
                    body: JSON.stringify({
                        model: state.model,
                        messages: [{ role: "system", content: state.systemPrompt }, ...chat.messages.slice(0, -1)],
                        stream: true
                    }),
                    signal: abortController.signal
                });

                const reader = response.body.getReader();
                const decoder = new TextDecoder();
                const lastAiContainer = dom.chatContainer.lastElementChild.querySelector('.ai-content');

                while (true) {
                    const { done, value } = await reader.read();
                    if (done) break;
                    const lines = decoder.decode(value).split('\n');
                    for (const line of lines) {
                        if (line.startsWith('data: ')) {
                            const dataStr = line.slice(6);
                            if (dataStr === '[DONE]') break;
                            try {
                                const data = JSON.parse(dataStr);
                                const token = data.choices[0]?.delta?.content || '';
                                aiMsg.content += token;
                                lastAiContainer.innerHTML = marked.parse(aiMsg.content);
                                setupCodeHelpers();
                                dom.chatContainer.scrollTop = dom.chatContainer.scrollHeight;
                            } catch (e) {}
                        }
                    }
                }
            } catch (err) {
                if (err.name !== 'AbortError') aiMsg.content += `\n\n‚ùå Error: ${err.message}`;
            } finally {
                abortController = null;
                dom.typingUI.classList.add('hidden');
                dom.stopBtn.classList.add('hidden');
                saveToLocal();
                renderChatList();
            }
        }

        function renderMessages() {
            const chat = state.chats.find(c => c.id === state.currentChatId);
            if (!chat || chat.messages.length === 0) {
                dom.welcomeView.classList.remove('hidden');
                dom.chatContainer.innerHTML = '';
                dom.chatContainer.appendChild(dom.welcomeView);
                return;
            }
            dom.welcomeView.classList.add('hidden');
            dom.currentChatTitle.innerText = chat.title;
            
            dom.chatContainer.innerHTML = chat.messages.map(msg => `
                <div class="flex flex-col ${msg.role === 'user' ? 'items-end' : 'items-start'} message-in">
                    <div class="max-w-[85%] p-4 rounded-2xl ${
                        msg.role === 'user' 
                        ? 'bg-blue-600 text-white rounded-tr-none shadow-lg shadow-blue-500/10' 
                        : 'bg-white dark:bg-[#161b22] border border-slate-200 dark:border-slate-800 rounded-tl-none prose dark:prose-invert ai-content'
                    }">
                        ${msg.role === 'user' ? escapeHtml(msg.content) : marked.parse(msg.content)}
                    </div>
                </div>
            `).join('');
            setupCodeHelpers();
            dom.chatContainer.scrollTop = dom.chatContainer.scrollHeight;
        }

        function setupCodeHelpers() {
            Prism.highlightAll();
            document.querySelectorAll('pre').forEach(block => {
                if (block.querySelector('.copy-btn')) return;
                const btn = document.createElement('button');
                btn.className = 'copy-btn';
                btn.innerText = 'Copy';
                btn.onclick = () => {
                    const code = block.querySelector('code').innerText;
                    navigator.clipboard.writeText(code);
                    btn.innerText = 'Copied!';
                    setTimeout(() => btn.innerText = 'Copy', 2000);
                };
                block.appendChild(btn);
            });
        }

        function switchChat(id) {
            state.currentChatId = id;
            renderMessages();
            renderChatList();
            if (window.innerWidth < 768) toggleSidebar();
        }

        function renderChatList() {
            dom.chatList.innerHTML = state.chats.map(chat => `
                <div onclick="switchChat('${chat.id}')" class="group flex items-center justify-between p-3 rounded-xl cursor-pointer transition-all ${state.currentChatId === chat.id ? 'bg-blue-50 dark:bg-blue-900/20 text-blue-600 ring-1 ring-blue-500/20' : 'hover:bg-slate-100 dark:hover:bg-slate-800'}">
                    <span class="truncate text-xs font-bold uppercase tracking-tight">${chat.title}</span>
                    <button onclick="deleteChat('${chat.id}', event)" class="opacity-0 group-hover:opacity-100 p-1 hover:text-red-500">‚úï</button>
                </div>
            `).join('');
        }

        function deleteChat(id, e) {
            e.stopPropagation();
            state.chats = state.chats.filter(c => c.id !== id);
            if (state.currentChatId === id) state.currentChatId = null;
            saveToLocal(); renderChatList(); renderMessages();
        }

        function toggleDarkMode() {
            state.isDark = !state.isDark;
            document.documentElement.classList.toggle('dark');
            localStorage.setItem('umer_theme', state.isDark ? 'dark' : 'light');
        }

        function autoResize(t) { t.style.height = 'auto'; t.style.height = t.scrollHeight + 'px'; }
        function openSettings() {
            document.getElementById('api-key-input').value = state.apiKey;
            document.getElementById('model-input').value = state.model;
            document.getElementById('settings-modal').classList.remove('hidden');
        }
        function closeSettings() { document.getElementById('settings-modal').classList.add('hidden'); }
        function saveSettings() {
            state.apiKey = document.getElementById('api-key-input').value;
            state.model = document.getElementById('model-input').value || 'deepseek/deepseek-r1:free';
            localStorage.setItem('umer_api_key', state.apiKey);
            localStorage.setItem('umer_model', state.model);
            closeSettings();
        }
        function stopGeneration() { if (abortController) abortController.abort(); }
        function saveToLocal() { localStorage.setItem('umer_chats', JSON.stringify(state.chats)); }
        function
